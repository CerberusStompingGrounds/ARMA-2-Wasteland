#include "defineDIKCodes.inc"_swva={allUnits};if(count _this<=1)exitwith{_mjvs=missionnamespace getvariable['wxjh',objnull];if!(isnull _mjvs)exitwith{};createdialog"RscSpectator"};disableserialization;_uruh=[_this,0,"init",[""]]call clht;_bxwv=[_this,1,[],[[]]]call clht;switch _uruh do{case"Init":{disableserialization;_joxn=_bxwv select 0;dqkm=_joxn;iteu=0;ssac=true;kvky=true;qgtv=false;qrad=[];if(isnil{xqcq})then{xqcq=[false,false,false]};lqmu=gettext(configfile>>"cfgingameui">>"cursor">>"select");_ocsx=_joxn;_lmuv=_ocsx displayaddeventhandler["keydown","with uinamespace do {['keyDown',_this,''] call hjqp};"];_fcku=_ocsx displayaddeventhandler["keyup","with uinamespace do {['keyUp',_this,''] call hjqp};"];_dwoe=getposatl cameraon;_dwoe set[2,(_dwoe select 2)+2];_kurv="camera"camcreate _dwoe;_kurv cameraeffect["terminate","back"];_kurv setdir direction cameraon;_kurv camCommand"manual off";_kurv camCommand"inertia on";showcinemaborder false;showhud false;missionnamespace setvariable['lfuq',[[],[],[],[],[],[],[],[],[],[]]];missionnamespace setvariable['hdhp',["","","","","","","","","",""]];with missionnamespace do{_xsly=[]call _swva;cxjr=_kurv;wxjh=if(player in _xsly)then{player}else{if(count _xsly>0)then{_xsly select 0}else{objnull}};if!(isnull wxjh)then{vehicle wxjh switchcamera cameraview}else{[]spawn{with uinamespace do{["keyDown",[displaynull,DIK_RIGHT,false,false,false],""]call hjqp;["keyUp",[displaynull,DIK_RIGHT,false,false,false],""]call hjqp}}}};missionnamespace setvariable["RscStatic_mode",0];if!(xqcq select 0)then{xqcq set[0,true];with missionnamespace do{}};_ayoe=[position _kurv,vectorup _kurv,vectordir _kurv,velocity _kurv];(dqkm displayCtrl 3141)ctrlSetText(name(missionNamespace getVariable'wxjh'));waituntil{_xnta=if!(isnil{missionnamespace getvariable"RscSpectator_allowFreeCam"})then{missionnamespace getvariable"RscSpectator_allowFreeCam"}else{true};if(!kvky&&!_xnta)then{["switchView",[false,true],""]call hjqp};_ekqi=time+0.1;waituntil{isnull _kurv||time>_ekqi};if(isnull _kurv)then{_kurv="camera"camcreate getposatl cameraon;_kurv cameraeffect["internal","back"];_kurv setpos(_ayoe select 0);_kurv setvectordir(_ayoe select 1);_kurv setVectorup(_ayoe select 2);_kurv setvelocity(_ayoe select 3);_kurv camCommand"inertia on";_kurv camCommand"manual on";with missionnamespace do{cxjr=_kurv}};_ayoe=[position _kurv,vectordir _kurv,vectorup _kurv,velocity _kurv];isNull _joxn};showhud true;_joxn closedisplay 2;_ocsx displayremoveeventhandler["keydown",_lmuv];_ocsx displayremoveeventhandler["keyup",_fcku];dqkm=nil;qgtv=nil;qrad=nil;_kurv cameraeffect["terminate","back"];camdestroy _kurv;with missionnamespace do{wxjh=nil;cxjr=nil};player switchcamera"internal"};case"keyDown":{_key=_bxwv select 1;if!(_key in qrad)then{qrad set[count qrad,_key]};_jgsc=(DIK_LCONTROL)in qrad;_ywmu=false;_vysh=0;_hlxq=false;_kurv=missionnamespace getvariable['cxjr',objnull];_ieiu=kvky;_pbeh={with missionnamespace do{hdhp set[_this,name wxjh]}};_ogxr={with missionnamespace do{_pexx=hdhp select _this;_zqvd=name wxjh;_xsly=[]call _swva;{if(name _x==_pexx&&_pexx!=_zqvd)exitwith{_ywmu=true;wxjh=_x}}foreach _xsly}};_gkdw={with missionnamespace do{_kdxu=if(_ieiu)then{[_ieiu,name wxjh,cameraview]}else{[_ieiu,position cxjr,vectordir cxjr,vectorup cxjr,velocity _kurv]};lfuq set[_this,_kdxu]}};_udqx={_kdxu=(missionnamespace getvariable'lfuq')select _this;_ieiu=_kdxu select 0;_oqkg=kvky;_vril=str _ieiu!=str _oqkg;kvky=_ieiu;if(_vril)then{kvky=!kvky};if(_ieiu)then{_pexx=_kdxu select 1;_csrc=_kdxu select 2;_xsly=[]call _swva;{if(name _x==_pexx)exitwith{_ywmu=true;missionnamespace setvariable['wxjh',_x]}}foreach _xsly;["switchView",[false,_vril],""]call hjqp;cameraon switchcamera _csrc}else{["switchView",[false,_vril],""]call hjqp;_dwfb=_kdxu select 1;_zmvn=_kdxu select 2;_zgua=_kdxu select 3;_mxou=_kdxu select 4;_kurv camcommand"manual off";_kurv campreparetarget objnull;_kurv camcommitprepared 0;_kurv setpos _dwfb;_kurv setvectordir _zmvn;_kurv setvectorup _zgua;_kurv setvelocity _mxou;_kurv camcommand"manual on"}};switch _key do{case(DIK_SPACE):{if!(qgtv)then{["switchView",[_jgsc,true],""]call hjqp;_hlxq=true}};case(DIK_LMENU):{if!(qgtv)then{["switchView",[_jgsc,false],""]call hjqp;_hlxq=true}};case(DIK_NUMPAD0):{_hlxq=!_ieiu};case(DIK_N):{iteu=iteu+1;_geqw=iteu%3;switch(_geqw)do{case 0:{camusenvg false;false SetCamUseTi 0};case 1:{camusenvg true;false SetCamUseTi 0};case 2:{camusenvg false;true SetCamUseTi 0};case 3:{camusenvg false;true SetCamUseTi 1}};_hlxq=true};case(DIK_LEFT):{_vysh=-1;_ywmu=true;_hlxq=true};case(DIK_RIGHT):{_vysh=+1;_ywmu=true;_hlxq=true};case(DIK_DOWN):{_vysh=-10;_ywmu=true;_hlxq=true};case(DIK_UP):{_vysh=+10;_ywmu=true;_hlxq=true};case(DIK_F1):{if(_jgsc)then{0 call _pbeh}else{0 call _ogxr};_hlxq=true};case(DIK_F2):{if(_jgsc)then{1 call _pbeh}else{1 call _ogxr};_hlxq=true};case(DIK_F3):{if(_jgsc)then{2 call _pbeh}else{2 call _ogxr};_hlxq=true};case(DIK_F4):{if(_jgsc)then{3 call _pbeh}else{3 call _ogxr};_hlxq=true};case(DIK_F5):{if(_jgsc)then{4 call _pbeh}else{4 call _ogxr};_hlxq=true};case(DIK_F6):{if(_jgsc)then{5 call _pbeh}else{5 call _ogxr};_hlxq=true};case(DIK_F7):{if(_jgsc)then{6 call _pbeh}else{6 call _ogxr};_hlxq=true};case(DIK_F8):{if(_jgsc)then{7 call _pbeh}else{7 call _ogxr};_hlxq=true};case(DIK_F9):{if(_jgsc)then{8 call _pbeh}else{8 call _ogxr};_hlxq=true};case(DIK_F10):{if(_jgsc)then{9 call _pbeh}else{9 call _ogxr};_hlxq=true};case(DIK_1):{if(_jgsc)then{0 call _gkdw}else{0 call _udqx};_hlxq=true};case(DIK_2):{if(_jgsc)then{1 call _gkdw}else{1 call _udqx};_hlxq=true};case(DIK_3):{if(_jgsc)then{2 call _gkdw}else{2 call _udqx};_hlxq=true};case(DIK_4):{if(_jgsc)then{3 call _gkdw}else{3 call _udqx};_hlxq=true};case(DIK_5):{if(_jgsc)then{4 call _gkdw}else{4 call _udqx};_hlxq=true};case(DIK_6):{if(_jgsc)then{5 call _gkdw}else{5 call _udqx};_hlxq=true};case(DIK_7):{if(_jgsc)then{6 call _gkdw}else{6 call _udqx};_hlxq=true};case(DIK_8):{if(_jgsc)then{7 call _gkdw}else{7 call _udqx};_hlxq=true};case(DIK_9):{if(_jgsc)then{8 call _gkdw}else{8 call _udqx};_hlxq=true};case(DIK_0):{if(_jgsc)then{9 call _gkdw}else{9 call _udqx};_hlxq=true}};with missionnamespace do{_xsly=[]call _swva;if(_ywmu&&count _xsly>0)then{_cclp=_xsly find wxjh;_cclp=_cclp+_vysh;_cclp=((count _xsly)+_cclp)%(count _xsly);wxjh=_xsly select _cclp;((uiNamespace getVariable'dqkm')displayCtrl 3141)ctrlSetText(name wxjh);if(_ieiu)then{vehicle wxjh switchcamera cameraview}}};_hlxq};case"keyUp":{_key=_bxwv select 1;qrad=qrad -[_key]};case"switchView":{_jgsc=_bxwv select 0;_yput=_bxwv select 1;_xnta=if!(isnil{missionnamespace getvariable"RscSpectator_allowFreeCam"})then{missionnamespace getvariable"RscSpectator_allowFreeCam"}else{true};_mjvs=missionnamespace getvariable['wxjh',player];if(!_xnta&&isnull _mjvs)then{_kurv camCommand"manual off";_kurv cameraeffect["terminate","back"];player switchcamera"internal"}else{if!(_yput)then{kvky=!kvky};if(kvky)then{if(_xnta)then{if(!_jgsc)then{_secf=_mjvs selectionposition"pilot";_cvdg=getarray(configfile>>"CfgVehicles">>typeof vehicle _mjvs>>"extCameraPosition");if(count _cvdg!=3)then{_cvdg=[0,0,0]};_rqsc=[0,0,0];_rqsc set[0,(_secf select 0)+(_cvdg select 0)];_rqsc set[1,(_secf select 1)+(_cvdg select 2)];_rqsc set[2,(_secf select 2)+(_cvdg select 1)];_kurv setpos(_mjvs modeltoworld _rqsc);_kurv campreparetarget vehicle _mjvs;_kurv camcommitprepared 0};_kurv setvelocity[0,0,0];_kurv camcommand"manual on";_kurv cameraeffect["internal","back"];cameraeffectenablehud true;if(_yput)then{missionnamespace setvariable["RscStatic_mode",0];("RscSpectator_fade"call bis_fnc_rsclayer)cutrsc["rscstatic","plain"]}else{("RscSpectator_fade"call bis_fnc_rsclayer)cuttext["","black in"]};if!(xqcq select 1)then{xqcq set[1,true];with missionnamespace do{[["spectating","spectatorfreeview"]]spawn bis_fnc_advhint}}};kvky=!kvky}else{if(_yput)then{_kurv camCommand"manual off";_kurv cameraeffect["terminate","back"];_kurv setvelocity[0,0,0];vehicle _mjvs switchcamera cameraview;if(_xnta)then{if(_yput)then{missionnamespace setvariable["RscStatic_mode",0]}else{}};if!(xqcq select 2)then{xqcq set[2,true];with missionnamespace do{}}};kvky=!kvky}}}};