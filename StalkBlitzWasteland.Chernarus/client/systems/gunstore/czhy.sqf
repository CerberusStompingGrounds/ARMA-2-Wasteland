closeDialog 0;private["_imhg","_pats","_rbla","_zovt"];_imhg=player;{if(!isPlayer _x)exitwith{_imhg=_x};nil}count(getPosATL player nearEntities["Man",50]);_pats=[getPosATL _imhg,2,getDir _imhg+90]call bis_fnc_relpos;_xvlp=nearestObjects[_pats,["ReammoBox"],5];{if(_x isKindOf"WeaponHolder")then{_xvlp set[_foreachindex,"REMOVE"]}}forEach _xvlp;_xvlp=_xvlp -["REMOVE"];_zovt={private["_rbla","_zkyr","_elhb","_whlr"];_rbla=_this select 0;_zkyr=_this select 1;private["_elhb","_whlr"];_elhb=[[],0]call zfdd;_whlr=[[],0]call zfdd;{if((_x select 0)=="CfgWeapons")then{[_elhb,_x select 1,([_elhb,_x select 1]call uvzk)+1]call zbrm}else{[_whlr,_x select 1,([_whlr,_x select 1]call uvzk)+1]call zbrm};nil}count _zkyr;[_elhb,{_rbla addWeaponCargoGlobal[_key,_value]}]call qwvt;[_whlr,{_rbla addMagazineCargoGlobal[_key,_value]}]call qwvt;(_zkyr call fped)call tziw};if(count _xvlp==0)then{["USBasicWeaponsBox",_pats,"basePart",[+seyj,_zovt],{clearWeaponCargoGlobal(_this select 0);clearMagazineCargoGlobal(_this select 0);player reveal(_this select 0);[_this select 0,_this select 1 select 0]call(_this select 1 select 1)}]call upgo}else{[_xvlp select 0,seyj]call _zovt};